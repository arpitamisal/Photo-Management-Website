define("progressionTool",["exports"],function(a){function b(){this.feedbackMessage="",this.explanationMessage="",this.userAnswer="",this.expectedAnswer="",this._hasStartedProgression=!1,this._shownJumpMessage=!1,this.showSolution=!1,this.solutionCallback=null,this.init=function(a,b,c){var d=this;this.name="progressionTool",this.id=a,this.parentResource=b,this.numToWin=c.numToWin,this.toolSpecificStartButtonBehavior=c.start,this.toolSpecificResetButtonBehavior=c.reset,this.toolSpecificNextButtonBehavior=c.next,this.toolSpecificCheckWhetherAnswerIsCorrect=c.isCorrect,this.toolSpecificInitialize=c.initialize,this.showSolution=c.showSolution,this.useMultipleParts="useMultipleParts"in c&&c.useMultipleParts,this.isExam=c.isExam,this.currentQuestionAnsweredCorrectly=!1,this.canLevelJump=this.useMultipleParts&&!this.isExam;var e='<style>.zyante-bold{font-family:HelveticaNeue-Light,"Helvetica Neue Light","Helvetica Neue",Helvetica,Arial,"Lucida Grande",sans-serif;font-weight:300}.zyante-section-bold{font-family:Helvetica;font-weight:300}.progressionTool{min-width:425px}.progressionTool div.zyante-progression-start-reset-buttons-container{height:45px;margin-bottom:10px}.progressionTool button.zyante-progression-next-button,.progressionTool button.zyante-progression-try-again,.progressionTool button.zyante-progression-show-solution{margin-left:30px}.progressionTool button.zyante-progression-reset-button,.progressionTool button.zyante-progression-show-solution{background-color:#fff;color:#5780a6}.progressionTool button.zyante-progression-reset-button:hover:not(.disabled),.progressionTool button.zyante-progression-show-solution:hover:not(.disabled){background-color:#fff}.progressionTool div.zyante-progression-tool-specific-outlet{margin-bottom:10px}.progressionTool div.zyante-progression-tool-specific-outlet.is-exam{margin-bottom:25px}.progressionTool div.zyante-progression-status-bar{align-items:stretch;background-color:#eee;border:1px solid #5780a6;display:flex;height:30px}.progressionTool div.zyante-progression-status-bar div{align-items:center;color:#999;display:flex;font-size:10px;justify-content:center;width:100%}.progressionTool div.zyante-progression-status-bar div.filled{background-color:#87add2;color:#eee}.progressionTool div.zyante-progression-status-bar div.highlighted{border:0;font-weight:700;font-size:15px;outline:3px solid #576E91;z-index:1}.progressionTool div.zyante-progression-status-bar div.highlighted:not(.filled){color:gray}.progressionTool div.zyante-progression-status-bar div:not(:last-child){border-right:1px dashed #5780a6}.progressionTool div.zyante-progression-status-bar div:not(:last-child).highlighted{border:0}.progressionTool span.zyante-progression-x-mark{color:#bb0404;font-size:18px;font-style:normal}.progressionTool div.check-next-container{display:flex;margin-top:10px}.progressionTool div.zyante-progression-is-done{align-self:center}.progressionTool div.zyante-progression-explanation-area{margin-top:15px}.progressionTool div.zyante-progression-spinner{display:inline-block;height:40px;margin-left:30px;position:relative;vertical-align:top;width:20px}.progressionTool.progression-started div.zyante-progression-status-bar div{cursor:pointer}.progressionTool div.zyante-progression-solution-area{align-items:center;display:flex;margin-top:25px}.progressionTool div.zyante-progression-solution-area .solution{margin-left:20px}</style>';if(this.utilities=require("utilities"),this.$tool=$("#"+this.id),this.isExam&&1!==this.numToWin)return void this.$tool.text("Can only have 1 level in exam mode");if(this.$tool.addClass("progressionTool"),b.needsAccessible&&b.needsAccessible()&&c.accessibleViewForLevel){var f=this.utilities.createArrayOfSizeN(this.numToWin).map(function(a,b){return b}),g=f.map(function(a){return c.accessibleViewForLevel(a)});Promise.all(g).then(function(a){var b=a.map(function(a,b){return"<p>Level "+(b+1)+"</p>"+a}),c=b.join("");d.$tool.html(e+c)},function(a){d.$tool.html("<p>Error: "+a+"</p>"),require("zyWebErrorManager").postError(a)})}else{this.checkmarkImageURL=this.utilities.getCheckmarkImageURL(b);var h=this[this.name].progressionTool({canLevelJump:this.canLevelJump,isExam:this.isExam,numberOfSegments:this.numToWin,toolSpecificCSS:c.css,toolSpecificHTML:c.html});this.$tool.html(e+h),this.currentQuestionNumber=0,this.recordProgressionLevel(),this.$startButton=this.$tool.find(".zyante-progression-start-button"),this.$resetButton=this.$tool.find(".zyante-progression-reset-button"),this.$questionArea=this.$tool.find(".zyante-progression-tool-specific-outlet"),this.$nextButton=this.$tool.find(".zyante-progression-next-button"),this.$tryAgainButton=this.$tool.find(".zyante-progression-try-again"),this.$showSolutionButton=this.$tool.find(".zyante-progression-show-solution"),this.$checkButton=this.$tool.find(".zyante-progression-check-button"),this.$progressionBarSegments=this.$tool.find(".zyante-progression-status-bar div"),this.$isDone=this.$tool.find(".zyante-progression-is-done"),this.$xMark=this.$tool.find(".zyante-progression-x-mark"),this.$checkmark=this.$tool.find(".zyante-progression-checkmark"),this.$explanation=this.$tool.find(".zyante-progression-explanation"),this.$explanationArea=this.$tool.find(".zyante-progression-explanation-area"),this.$solutionArea=this.$tool.find(".zyante-progression-solution-area"),this.$solution=this.$solutionArea.find(".solution"),this.spinnerDiv=this.$tool.find(".zyante-progression-spinner")[0],this.$resetButton.hide(),this.utilities.disableButton(this.$nextButton),this.utilities.disableButton(this.$tryAgainButton),1===this.numToWin?this.$nextButton.hide():this.$tryAgainButton.hide(),this.utilities.disableButton(this.$showSolutionButton),this.showSolution||this.$showSolutionButton.hide(),this.$solutionArea.hide(),this.isExam&&this.$checkButton.text("Submit"),this.utilities.disableButton(this.$checkButton),this.$isDone.hide(),this.$xMark.hide(),this.$checkmark.hide(),this.$checkmark.attr("src",this.checkmarkImageURL),this._highlightCurrentLevel(),this.$startButton.click(function(){return d.startButtonClick(),!1}),this.$resetButton.click(function(){d.resetButtonClick()}),this.$nextButton.click(function(){return d.nextButtonClick(),!1}),this.$tryAgainButton.click(function(){return d.tryAgainButtonClick(),!1}),this.$checkButton.click(function(){d.checkButtonClick()}),this.$showSolutionButton.click(function(){d.showSolutionButtonClick()}),this.canLevelJump&&(this._shownJumpMessage=b.getLocalStore("shownJumpMessage"),this.$progressionBarSegments.click(function(a){if(d._hasStartedProgression){var c=d.$progressionBarSegments.index(a.target),e=c+1,f=d.$progressionBarSegments.map(function(a,b){return $(b).hasClass("filled")}),g=c-1,h=g>=0&&!f[g],i=b.isStudent(),j="Level jump";if(i&&h)b.alert(j,"Must first complete all earlier levels.");else if(!i&&d._shownJumpMessage)d._jumpToLevel(d.currentQuestionNumber,c);else{var k=i?"Yes, jump.":"Ok, got it.",l={keepOpen:!1,label:k,decoration:"button-blue",callback:function(){d._jumpToLevel(d.currentQuestionNumber,c)}};if(i){var m="Jump to level "+e+"? Completion is preserved.";d.parentResource.showModal(j,m,l,{keepOpen:!1,label:"No, don't jump.",decoration:"button-red"})}else if(!d._shownJumpMessage){var n="Students can only jump to completed levels, or next uncompleted level. Instructors are allowed to jump to any level.";d.parentResource.showModal(j,n,l)}d._shownJumpMessage=!0,d.parentResource.setLocalStore("shownJumpMessage",d._shownJumpMessage)}}})),this._fillCompletedLevels();var i=!1;this.toolSpecificInitialize&&(i=this.toolSpecificInitialize()),this.isExam&&(this.startButtonClick(),i&&this.checkButtonClick(!0))}},this.recordUserAction=function(a){this.parentResource.postEvent({part:this.currentQuestionNumber,complete:!1,metadata:a})},this.jumpToLevelIndex=function(a){this.currentQuestionNumber=a,this._loadNextQuestion()},this._jumpToLevel=function(a,b){this.recordUserAction({jumpedLevel:!0,jumpedFromLevelIndex:a,jumpedToLevelIndex:b}),this.jumpToLevelIndex(b)},this._fillCompletedLevels=function(){var a=this,b=this.parentResource.activityCompletion();Promise.resolve(b).then(function(b){a._processActivityCompletionObject(b)})},this._processActivityCompletionObject=function(a){var b=this,c=a.partsCompletionStatus.map(function(a){return 1===a.complete}),d=c.map(function(a,b){var c=null;return a&&(c=b),c}).filter(function(a){return null!==a}),e=[];this.useMultipleParts?e=d:0===d[0]&&(e=this.$progressionBarSegments.map(function(a){return a}).toArray()),e.forEach(function(a){b.$progressionBarSegments.eq(a).addClass("filled")})},this.startButtonClick=function(){this._hasStartedProgression=!0,this.recordUserAction({startClicked:!0}),this.useMultipleParts&&this.$tool.addClass("progression-started"),this.$startButton.hide(),this.$resetButton.show(),this.utilities.enableButton(this.$checkButton),this.utilities.enableButton(this.$showSolutionButton),this.toolSpecificStartButtonBehavior()},this.displayResetConfirmModal=function(){var a=this,b={keepOpen:!1,label:"Yes, jump.",decoration:"button-blue",callback:function(){a.reset()}},c=this.canLevelJump?" Completion is preserved.<br/>Note: Can click a level to jump.":"",d="Jump to level 1?"+c;this.parentResource.showModal("Level jump",d,b,{keepOpen:!1,label:"No, don't jump.",decoration:"button-red"})},this.resetButtonClick=function(){this.currentQuestionNumber>0?this.displayResetConfirmModal():this.reset()},this._highlightCurrentLevel=function(){this.$progressionBarSegments.removeClass("highlighted").eq(this.currentQuestionNumber).addClass("highlighted")},this._loadNextQuestion=function(){var a=this;this.currentQuestionAnsweredCorrectly=!1,this.recordProgressionLevel(),this.utilities.disableButton(this.$nextButton),this.utilities.disableButton(this.$tryAgainButton),this.utilities.enableButton(this.$checkButton),this.utilities.enableButton(this.$showSolutionButton),this.$solutionArea.hide(),this.$solution.html(""),this.$isDone.hide(),this.$xMark.hide(),this.$checkmark.hide(),this._highlightCurrentLevel();var b=this.toolSpecificNextButtonBehavior(this.currentQuestionNumber)||!1;Boolean(this.$explanation.text())&&!b&&(this.$explanationArea.css("height",this.$explanationArea.height()),this.$explanation.text(""),this.$explanationArea.animate({height:0},{complete:function(){a.$explanationArea.css("height","auto")}})),this.parentResource.scrollToTop()},this.nextButtonClick=function(){this.$nextButton.hasClass("disabled")||(this.currentQuestionAnsweredCorrectly&&this.currentQuestionNumber++,this.recordUserAction({nextClicked:!0,nextLevel:Boolean(this.currentQuestionAnsweredCorrectly)}),this._loadNextQuestion())},this.tryAgainButtonClick=function(){this.$tryAgainButton.hasClass("disabled")||(this._loadNextQuestion(),this.recordUserAction({tryAgainClicked:!0}))},this.postUserAnswerAndExpectedAnswer=function(a,b){var c=a,d=this.currentQuestionNumber;if(!this.useMultipleParts){var e=this.currentQuestionNumber+1===this.numToWin;c=a&&e,d=0}var f=$.extend(b,{expectedAnswer:this.expectedAnswer});this.parentResource.postEvent({answer:this.userAnswer,complete:c?1:0,metadata:f,part:d})},this.startSpinner=function(){var a={lines:13,length:5,width:3,radius:7,corners:1,rotate:0,direction:1,color:"#CC6600",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"50%",left:"50%"};this.spinner=new Spinner(a).spin(this.spinnerDiv)},this.stopSpinner=function(){this.spinner&&(this.spinner.stop(),this.spinner=null)},this.handleCorrectnessValue=function(a,b){var c=!1,d=!1,e=null,f=!1,g={},h=1===this.numToWin,i={};if(a instanceof Object?(this.explanationMessage=a.explanationMessage,this.userAnswer=a.userAnswer,this.expectedAnswer=a.expectedAnswer,"latexChanged"in a&&(d=a.latexChanged),"callbackFunction"in a&&(e=a.callbackFunction),"callbackParameters"in a&&(i=a.callbackParameters),"explanationAsText"in a&&(f=a.explanationAsText),"metadata"in a&&(g=a.metadata),"showTryAgain"in a&&(h=a.showTryAgain),c=a.isCorrect||this.isExam,h=this.isExam||h):c=a,b||this.postUserAnswerAndExpectedAnswer(c,g),this.isExam||(c?(this.$progressionBarSegments.eq(this.currentQuestionNumber).addClass("filled"),this.$checkmark.show()):this.$xMark.show()),this.showSolution&&(this.$checkmark.hide(),this.$xMark.hide()),this.outputThenScrollToExplanation(this.explanationMessage,f,b),d&&this.parentResource.latexChanged(),c&&this.currentQuestionNumber+1===this.numToWin)this.$isDone.show();else{var j=h?this.$tryAgainButton:this.$nextButton;(h?this.$nextButton:this.$tryAgainButton).hide(),j.show(),this.utilities.enableButton(j),b||j.focus()}this.currentQuestionAnsweredCorrectly=c,e&&e(i)},this.outputThenScrollToExplanation=function(a){var b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],c=arguments.length>2&&void 0!==arguments[2]&&arguments[2];b?this.$explanation.text(a):this.$explanation.html(a),this.$explanationArea.hide().fadeIn(),c||this.parentResource.scrollToBottom()},this.checkButtonClick=function(){var a=this,b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.$checkButton.hasClass("disabled")){this.utilities.disableButton(this.$checkButton);var c=this.toolSpecificCheckWhetherAnswerIsCorrect(this.currentQuestionNumber);this.startSpinner(),Promise.resolve(c).then(function(c){a.stopSpinner(),a.handleCorrectnessValue(c,b)},function(b){a.stopSpinner(),a.utilities.enableButton(a.$checkButton),a.outputThenScrollToExplanation(b)})}},this.showSolutionButtonClick=function(){var a=this;this.parentResource.showModal("Show solution then get a new problem?","",{keepOpen:!1,label:"Yes, show/get.",decoration:"button-blue",callback:function(){a.confirmedShowSolution()}},{keepOpen:!1,label:"No, don't show/get.",decoration:"button-red"})},this.confirmedShowSolution=function(){this.utilities.disableButton(this.$checkButton),this.$nextButton.show(),this.utilities.enableButton(this.$nextButton),this.$tryAgainButton.hide(),this.utilities.disableButton(this.$tryAgainButton),this.utilities.disableButton(this.$showSolutionButton),this.solutionCallback(this.$solution),this.$solutionArea.hide().fadeIn(),this.parentResource.scrollToBottom()},this.setSolutionCallback=function(a){this.solutionCallback=a},this.reset=function(){this.$resetButton.show(),this._jumpToLevel(this.currentQuestionNumber,0)},this.check=function(){this.checkButtonClick()},this.recordProgressionLevel=function(){this.parentResource.setProgressionLevel&&this.parentResource.setProgressionLevel(this.currentQuestionNumber)},this.progressionTool=this.progressionTool||{},this.progressionTool.progressionTool=Handlebars.template({1:function(a,b,c,d,e){return"        <div class='zyante-progression-start-reset-buttons-container'>\n            <button class='zyante-progression-start-button button'>Start</button>\n            <button class='zyante-progression-reset-button button'>Jump to level 1</button>\n        </div>\n"},3:function(a,b,c,d,e){return" is-exam"},5:function(a,b,c,d,e){var f;return"        <div class='zyante-progression-status-bar'>\n"+(null!=(f=(c.rangeOneIndexed||b&&b.rangeOneIndexed||c.helperMissing).call(null!=b?b:a.nullContext||{},null!=b?b.numberOfSegments:b,{name:"rangeOneIndexed",hash:{},fn:a.program(6,e,0),inverse:a.noop,data:e}))?f:"")+"        </div>\n"},6:function(a,b,c,d,e){return"                <div>"+a.escapeExpression(a.lambda(b,b))+"</div>\n"},8:function(a,b,c,d,e){return" Click any level to practice more. Completion is preserved."},compiler:[7,">= 4.0.0"],main:function(a,b,c,e,f){var g,h,i=null!=b?b:a.nullContext||{},j=c.helperMissing,k="function";return"\n"+(null!=(h=null!=(h=c.toolSpecificCSS||(null!=b?b.toolSpecificCSS:b))?h:j,g=(void 0===h?"undefined":d(h))===k?h.call(i,{name:"toolSpecificCSS",hash:{},data:f}):h)?g:"")+"\n\n<div class='zyante-progression-modal-cover'>\n"+(null!=(g=c.unless.call(i,null!=b?b.isExam:b,{name:"unless",hash:{},fn:a.program(1,f,0),inverse:a.noop,data:f}))?g:"")+"\n    <div class='zyante-progression-tool-specific-outlet"+(null!=(g=c.if.call(i,null!=b?b.isExam:b,{name:"if",hash:{},fn:a.program(3,f,0),inverse:a.noop,data:f}))?g:"")+"'>\n        "+(null!=(h=null!=(h=c.toolSpecificHTML||(null!=b?b.toolSpecificHTML:b))?h:j,g=(void 0===h?"undefined":d(h))===k?h.call(i,{name:"toolSpecificHTML",hash:{},data:f}):h)?g:"")+"\n    </div>\n\n"+(null!=(g=c.unless.call(i,null!=b?b.isExam:b,{name:"unless",hash:{},fn:a.program(5,f,0),inverse:a.noop,data:f}))?g:"")+"\n    <div class='check-next-container'>\n        <div><button class='zyante-progression-check-button button'>Check</button></div>\n        <div><button class='zyante-progression-next-button button'>Next</button></div>\n        <div><button class='zyante-progression-try-again button'>Try again</button></div>\n        <div><button class='zyante-progression-show-solution button'>Show solution</button></div>\n        <div class='zyante-progression-spinner'></div>\n        <div class='zyante-progression-is-done correct'><b>Done</b>."+(null!=(g=c.if.call(i,null!=b?b.canLevelJump:b,{name:"if",hash:{},fn:a.program(8,f,0),inverse:a.noop,data:f}))?g:"")+"</div>\n    </div>\n    <div class='zyante-progression-explanation-area'>\n        <span class='zyante-progression-x-mark' role='img' aria-label='Incorrect'>&#x2716;</span>\n        <img class='zyante-progression-checkmark' alt='Correct'>\n        <span class='zyante-progression-explanation'></span>\n    </div>\n    <div class='zyante-progression-solution-area'>\n        <div>Solution</div>\n        <div class='solution'></div>\n    </div>\n</div>\n"},useData:!0})}var c={},d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};Handlebars.registerHelper("rangeOneIndexed",function(a,b){for(var c="",d=0;d<a;++d)c+=b.fn(d+1);return c});var e={create:function(){return new b},dependencies:{vendorJS:["spin.min.js"],tools:["utilities"]},runTests:function(){}};c.exports=e,a.default=c.exports});